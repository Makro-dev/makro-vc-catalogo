"use strict";console.log("üîê Strict-safe activado"),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("destacados")||document.getElementById("ofertas"),t=document.getElementById("btn-buscar"),n=document.getElementById("productImage"),o=!0===document.documentElement.hasAttribute("data-og-only"),a=document.getElementById("hamburger"),s=document.querySelector(".sidebar");a&&s&&a.addEventListener("click",()=>{s.classList.toggle("active"),document.body.classList.toggle("sidebar-open")}),window.visualViewport&&window.visualViewport.addEventListener("resize",()=>{const e=window.visualViewport.height<window.innerHeight-120;document.body.classList.toggle("keyboard-open",e)});const r=document.querySelectorAll(".fade-up, .slide-left, .slide-right");if(r.length){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("show"),e.unobserve(t.target))})},{threshold:.2});r.forEach(t=>e.observe(t))}const i=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;t.src=t.dataset.src||t.src,t.removeAttribute("data-src"),t.classList.remove("lazy-img"),i.unobserve(t)}})},{rootMargin:"200px 0px"});if(document.querySelectorAll("img[data-src]").forEach(e=>i.observe(e)),e&&"undefined"!=typeof PRODUCTS){const e=document.getElementById("destacados"),t=document.getElementById("ofertas");if("undefined"!=typeof PRODUCTS){PRODUCTS.forEach(n=>{if(n.oferta&&t){const e=document.createElement("article");e.className="product-card en-oferta",e.innerHTML=`\n          ${n.oferta?'<span class="badge-oferta">OFERTA</span>':""}\n          ${n.nuevo?'<span class="badge-nuevo">NUEVO</span>':""}\n          ${n.disponible?"":'<span class="badge-agotado">AGOTADO</span>'}\n          <img data-src="${n.imagen}" alt="${n.nombre}" class="lazy-img" width="200" height="240" decoding="async">\n          <h3>${n.nombre}</h3>\n          <p class="price">USD ${n.precio.usd}</p>\n          ${renderStars(n.estrellas)}\n          <div class="card-actions">\n            <a href="producto-${n.id}.html" class="btn">Ver detalles</a>\n          </div>\n          `,t.appendChild(e),i.observe(e.querySelector("img"))}if(n.destacado&&e){const t=document.createElement("article");t.className="product-card",t.innerHTML=`\n          <img\n            data-src="${n.imagen}"\n            alt="${n.nombre}"\n            class="lazy-img"\n            width="200"\n            height="240"\n            decoding="async"\n          >\n          <h3>${n.nombre}</h3>\n          <p class="price">USD ${n.precio.usd}</p>\n          ${renderStars(n.estrellas)}\n        \n          <div class="card-actions">\n            <a href="producto-${n.id}.html" class="btn">Ver detalles</a>\n          </div>\n          `,e.appendChild(t),i.observe(t.querySelector("img"))}});(()=>{document.querySelectorAll(".ofertas.scroll-horizontal, .destacados.scroll-horizontal").forEach(e=>{let t=.8,n=1,o=!1;const a=()=>{const n=e.querySelectorAll(".product-card, .offer-card");t=Math.max(.5,Math.min(1.5,n.length/6))};a(),window.addEventListener("resize",a);const s=()=>{o||(e.scrollLeft+=t*n,e.scrollLeft+e.clientWidth>=e.scrollWidth?n=-1:e.scrollLeft<=0&&(n=1)),requestAnimationFrame(s)};s(),e.addEventListener("mouseenter",()=>o=!0),e.addEventListener("mouseleave",()=>o=!1),e.style.scrollBehavior="auto"})})()}}if(t&&"undefined"!=typeof PRODUCTS){const e=document.getElementById("search"),t=document.getElementById("categoria"),n=document.getElementById("zona"),o=document.getElementById("orden"),a=document.getElementById("filtro-resultados"),s=document.querySelectorAll(".categoria"),r=document.getElementById("btn-buscar"),d=document.getElementById("btn-limpiar"),c=document.getElementById("btn-cargar-mas"),l="makrovc_filtro",u=12;let m=u,g=[],p=JSON.parse(localStorage.getItem(l))||{search:"",categoria:"todas",zona:"todas",orden:"default"};e&&(e.value=p.search),t&&(t.value=p.categoria),n&&(n.value=p.zona),o&&(o.value=p.orden);const h=()=>localStorage.setItem(l,JSON.stringify(p)),y=()=>f(g.slice(0,m)),f=e=>{s.forEach(e=>{e.querySelector(".product-grid").innerHTML="",e.style.display="none"});const t={};e.forEach(e=>{t[e.categoria]||(t[e.categoria]=[]),t[e.categoria].push(v(e))}),Object.entries(t).forEach(([e,t])=>{const n=document.getElementById(e);if(!n)return;const o=n.querySelector(".product-grid");o.innerHTML=t.join(""),n.style.display="",o.classList.contains("scroll-horizontal")?(o.style.display="flex",o.style.overflowX="auto",o.style.flexWrap="nowrap",o.style.gap="12px",o.style.padding="0 12px",o.querySelectorAll(".product-card").forEach(e=>{e.style.flex="0 0 auto",e.style.width="160px",e.style.marginRight="12px"})):o.classList.remove("scroll-horizontal"),o.querySelectorAll("img[data-src]").forEach(e=>i.observe(e))})},v=e=>{const t=e.disponible?"":"product-soldout";return`\n      <article class="product-card ${e.oferta?"en-oferta":""} ${t}">\n        ${e.oferta?'<span class="badge-oferta">OFERTA</span>':""}\n        ${e.nuevo?'<span class="badge-nuevo">NUEVO</span>':""}\n        ${e.disponible?"":'<span class="badge-agotado">AGOTADO</span>'}\n        <img data-src="${e.imagen}" alt="${e.nombre}" class="lazy-img" width="200" height="240" decoding="async">\n        <h3>${e.nombre}</h3>\n        <p class="price">USD ${e.precio.usd}</p>\n        ${renderStars(e.estrellas)}\n        <div class="card-actions">\n          <a href="producto-${e.id}.html"\n            class="btn ${e.disponible?"":"disabled"}" \n            ${e.disponible?"":'aria-disabled="true"'}>\n            ${e.disponible?"Ver":"Agotado"}\n          </a>\n        </div>\n      </article>\n      `},b=()=>{if(!d)return;const a=""!==e.value.trim()||"todas"!==t.value||"todas"!==n.value||"default"!==o.value;d.classList.toggle("show",a)},E=()=>{if("undefined"==typeof PRODUCTS)return;let e=[...PRODUCTS];if(p.search){const t=p.search.toLowerCase();e=e.filter(e=>e.nombre.toLowerCase().includes(t))}"todas"!==p.categoria&&(e=e.filter(e=>e.categoria===p.categoria)),"todas"!==p.zona&&(e=e.filter(e=>e.zonasEnvio&&(e.zonasEnvio.incluida?.includes(p.zona)||e.zonasEnvio.adicional?.includes(p.zona)))),"asc"===p.orden&&e.sort((e,t)=>e.precio.usd-t.precio.usd),"desc"===p.orden&&e.sort((e,t)=>t.precio.usd-e.precio.usd),g=e,m=u,y(),I(),a&&(a.textContent=0===g.length?"No se encontraron productos con esos filtros.":`Se encontraron ${g.length} productos.`)},I=()=>{c&&c.classList.toggle("hidden",m>=g.length)};c&&c.addEventListener("click",()=>{m+=u,y(),I()}),e&&(e.addEventListener("change",()=>{p.search=e.value.trim(),h(),E(),b()}),e.addEventListener("search",()=>{p.search=e.value.trim(),h(),E(),b()}),e.addEventListener("input",b)),[t,n,o].forEach(e=>{e&&e.addEventListener("change",()=>{p[e.id]=e.value,h(),E(),b()})}),r&&r.addEventListener("click",()=>{p.search=e.value.trim(),h(),E(),b()}),d&&d.addEventListener("click",()=>{p={search:"",categoria:"todas",zona:"todas",orden:"default"},e&&(e.value=""),t&&(t.value="todas"),n&&(n.value="todas"),o&&(o.value="default"),m=u,h(),E(),b()}),E(),b()}if(n&&"undefined"!=typeof PRODUCTS){let e=new URLSearchParams(location.search).get("id");if(!e){const t=location.pathname.match(/producto-(.+)\.html$/);t&&(e=t[1])}const t=document.querySelector(".producto-detalle"),n=document.querySelector(".no-product");if(!e)return t&&(t.style.display="none"),void(n&&(n.style.display="block"));if(e&&"undefined"!=typeof PRODUCTS){const a=PRODUCTS.find(t=>t.id===e);if(!a)return t&&(t.style.display="none"),void(n&&(n.style.display="block"));if(a){const e=document.getElementById("productImage"),n=document.getElementById("productName"),s=document.getElementById("productPrice"),r=document.getElementById("oldPrice"),i=document.getElementById("productDescription"),d=document.getElementById("productDetails"),c=document.getElementById("shippingInfo"),l=document.getElementById("whatsappBtn"),u=document.getElementById("callBtn"),m=document.getElementById("badgeOferta");if(e&&(e.src=a.imagen,e.alt=a.nombre),n&&(n.textContent=a.nombre),s&&(s.textContent=a.precio?.usd?`USD ${a.precio.usd}`:"Consultar"),i&&(i.textContent=a.descripcion||"Descripci√≥n no disponible"),m&&(m.style.display="none"),m&&(a.oferta&&a.precioAnterior?(m.textContent="OFERTA",m.style.display="inline-block"):a.nuevo?(m.textContent="NUEVO",m.style.display="inline-block"):a.disponible||(m.textContent="AGOTADO",m.style.display="inline-block")),r&&(a.oferta&&a.precioAnterior?(r.textContent=`USD ${a.precioAnterior}`,r.style.display="inline"):r.style.display="none"),d&&(d.innerHTML=(a.especificaciones||[]).map(e=>`<li>‚úî ${e}</li>`).join("")),c){let e="";a.zonasEnvio?.incluida?.length?e+=`<h4>Mensajer√≠a incluida</h4><ul class="zonas incluida">${a.zonasEnvio.incluida.map(e=>`<li>${e}</li>`).join("")}</ul>`:e+="<p><strong>Mensajer√≠a incluida:</strong> No disponible</p>",a.zonasEnvio?.adicional?.length&&(e+=`<h4>Mensajer√≠a adicional</h4><ul class="zonas adicional">${a.zonasEnvio.adicional.map(e=>`<li>${e}</li>`).join("")}</ul>`),a.monedas?.length&&(e+=`<p><strong>Monedas aceptadas:</strong> ${a.monedas.join(", ")}</p>`),a.garantia&&(e+=`<p><strong>Garant√≠a:</strong> ${a.garantia}</p>`),a.extras?.length&&(e+=`<p><strong>Extras:</strong> ${a.extras.join(", ")}</p>`),c.innerHTML=e}if(a.disponible?initContactButtons(l,u):(m&&(m.textContent="AGOTADO",m.style.display="inline-block"),l&&(l.removeAttribute("href"),l.classList.add("disabled"),l.textContent="Agotado",l.setAttribute("aria-disabled","true")),u&&(u.removeAttribute("href"),u.classList.add("disabled"),u.setAttribute("aria-disabled","true")),t&&t.classList.add("product-soldout")),!o){const e=document.getElementById("seoTitle"),t=document.getElementById("seoDescription"),n=document.getElementById("ogTitle"),o=document.getElementById("ogDescription"),s=document.getElementById("ogImage"),r=document.getElementById("preloadOgImage"),i=document.getElementById("ogUrl"),d=a.precio?.usd?`USD ${a.precio.usd}`:"Consultar precio",c=`${a.nombre} en venta en Makro VC. ${a.descripcion||""} Precio: ${d}. Mensajer√≠a incluida en Cuba.`,l=document.getElementById("canonicalLink");e&&(e.textContent=`${a.nombre} | Makro VC`),t&&t.setAttribute("content",c),n&&(n.content=a.nombre+" | Makro VC"),o&&(o.content=a.descripcion||"Producto disponible en Makro VC"),s&&(s.content=a.imagen),r&&(r.href=a.imagen),i&&(i.content=`https://makrovc.net/producto-${a.id}.html`),l&&a?.id&&(l.href=`https://makrovc.net/producto-${a.id}.html`)}}}}!function(){const e=document.querySelector(".testimonials-scroll");if(!e)return;if(window.innerWidth>768)return;let t=!1;e.addEventListener("touchstart",()=>{t=!0},{once:!0});const n=new IntersectionObserver(o=>{o.forEach(o=>{o.isIntersecting&&(n.disconnect(),setTimeout(()=>{t||e.scrollWidth<=e.clientWidth||e.scrollBy({left:80,behavior:"smooth"})},400))})},{threshold:.4});n.observe(e)}(),function(){const e=document.querySelectorAll(".testimonial.slide-right");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("show")})},{threshold:.3});e.forEach(e=>t.observe(e))}()});