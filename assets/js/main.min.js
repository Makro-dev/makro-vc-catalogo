"use strict";console.log("üîê Strict-safe activado"),document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("destacados")||document.getElementById("ofertas"),t=document.getElementById("btn-buscar"),n=document.getElementById("productImage"),o=document.getElementById("hamburger"),a=document.querySelector(".sidebar");o&&a&&o.addEventListener("click",()=>{a.classList.toggle("active"),document.body.classList.toggle("sidebar-open")}),window.visualViewport&&window.visualViewport.addEventListener("resize",()=>{const e=window.visualViewport.height<window.innerHeight-120;document.body.classList.toggle("keyboard-open",e)});const s=document.querySelectorAll(".fade-up, .slide-left, .slide-right");if(s.length){const e=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&(t.target.classList.add("show"),e.unobserve(t.target))})},{threshold:.2});s.forEach(t=>e.observe(t))}const r=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target;t.src=t.dataset.src||t.src,t.removeAttribute("data-src"),t.classList.remove("lazy-img"),r.unobserve(t)}})},{rootMargin:"200px 0px"});if(document.querySelectorAll("img[data-src]").forEach(e=>r.observe(e)),e&&"undefined"!=typeof PRODUCTS){const e=document.getElementById("destacados"),t=document.getElementById("ofertas");if("undefined"!=typeof PRODUCTS){PRODUCTS.forEach(n=>{if(n.oferta&&t){const e=document.createElement("article");e.className="product-card en-oferta",e.innerHTML=`\n          ${n.oferta?'<span class="badge-oferta">OFERTA</span>':""}\n          ${n.nuevo?'<span class="badge-nuevo">NUEVO</span>':""}\n          ${n.disponible?"":'<span class="badge-agotado">AGOTADO</span>'}\n          <img data-src="${n.imagen}" alt="${n.nombre}" class="lazy-img" width="200" height="240" decoding="async">\n          <h3>${n.nombre}</h3>\n          <p class="price">USD ${n.precio.usd}</p>\n          ${renderStars(n.estrellas)}\n          <div class="card-actions">\n            <a href="producto-${n.id}.html" class="btn">Ver detalles</a>\n          </div>\n          `,t.appendChild(e),r.observe(e.querySelector("img"))}if(n.destacado&&e){const t=document.createElement("article");t.className="product-card",t.innerHTML=`\n          <img\n            data-src="${n.imagen}"\n            alt="${n.nombre}"\n            class="lazy-img"\n            width="200"\n            height="240"\n            decoding="async"\n          >\n          <h3>${n.nombre}</h3>\n          <p class="price">USD ${n.precio.usd}</p>\n          ${renderStars(n.estrellas)}\n        \n          <div class="card-actions">\n            <a href="producto-${n.id}.html" class="btn">Ver detalles</a>\n          </div>\n          `,e.appendChild(t),r.observe(t.querySelector("img"))}});(()=>{document.querySelectorAll(".ofertas.scroll-horizontal, .destacados.scroll-horizontal").forEach(e=>{let t=.8,n=1,o=!1;const a=()=>{const n=e.querySelectorAll(".product-card, .offer-card");t=Math.max(.5,Math.min(1.5,n.length/6))};a(),window.addEventListener("resize",a);const s=()=>{o||(e.scrollLeft+=t*n,e.scrollLeft+e.clientWidth>=e.scrollWidth?n=-1:e.scrollLeft<=0&&(n=1)),requestAnimationFrame(s)};s(),e.addEventListener("mouseenter",()=>o=!0),e.addEventListener("mouseleave",()=>o=!1),e.style.scrollBehavior="auto"})})()}}if(t&&"undefined"!=typeof PRODUCTS){const e=document.getElementById("search"),t=document.getElementById("categoria"),n=document.getElementById("zona"),o=document.getElementById("orden"),a=document.getElementById("filtro-resultados"),s=document.querySelectorAll(".categoria"),i=document.getElementById("btn-buscar"),d=document.getElementById("btn-limpiar"),c=document.getElementById("btn-cargar-mas"),l="makrovc_filtro",u=12;let m=u,g=[],p=JSON.parse(localStorage.getItem(l))||{search:"",categoria:"todas",zona:"todas",orden:"default"};e&&(e.value=p.search),t&&(t.value=p.categoria),n&&(n.value=p.zona),o&&(o.value=p.orden);const h=()=>localStorage.setItem(l,JSON.stringify(p)),y=()=>f(g.slice(0,m)),f=e=>{s.forEach(e=>{e.querySelector(".product-grid").innerHTML="",e.style.display="none"});const t={};e.forEach(e=>{t[e.categoria]||(t[e.categoria]=[]),t[e.categoria].push(v(e))}),Object.entries(t).forEach(([e,t])=>{const n=document.getElementById(e);if(!n)return;const o=n.querySelector(".product-grid");o.innerHTML=t.join(""),n.style.display="",o.classList.contains("scroll-horizontal")?(o.style.display="flex",o.style.overflowX="auto",o.style.flexWrap="nowrap",o.style.gap="12px",o.style.padding="0 12px",o.querySelectorAll(".product-card").forEach(e=>{e.style.flex="0 0 auto",e.style.width="160px",e.style.marginRight="12px"})):o.classList.remove("scroll-horizontal"),o.querySelectorAll("img[data-src]").forEach(e=>r.observe(e))})},v=e=>{const t=e.disponible?"":"product-soldout";return`\n      <article class="product-card ${e.oferta?"en-oferta":""} ${t}">\n        ${e.oferta?'<span class="badge-oferta">OFERTA</span>':""}\n        ${e.nuevo?'<span class="badge-nuevo">NUEVO</span>':""}\n        ${e.disponible?"":'<span class="badge-agotado">AGOTADO</span>'}\n        <img data-src="${e.imagen}" alt="${e.nombre}" class="lazy-img" width="200" height="240" decoding="async">\n        <h3>${e.nombre}</h3>\n        <p class="price">USD ${e.precio.usd}</p>\n        ${renderStars(e.estrellas)}\n        <div class="card-actions">\n          <a href="producto-${e.id}.html"\n            class="btn ${e.disponible?"":"disabled"}" \n            ${e.disponible?"":'aria-disabled="true"'}>\n            ${e.disponible?"Ver":"Agotado"}\n          </a>\n        </div>\n      </article>\n      `},b=()=>{if(!d)return;const a=""!==e.value.trim()||"todas"!==t.value||"todas"!==n.value||"default"!==o.value;d.classList.toggle("show",a)},E=()=>{if("undefined"==typeof PRODUCTS)return;let e=[...PRODUCTS];if(p.search){const t=p.search.toLowerCase();e=e.filter(e=>e.nombre.toLowerCase().includes(t))}"todas"!==p.categoria&&(e=e.filter(e=>e.categoria===p.categoria)),"todas"!==p.zona&&(e=e.filter(e=>e.zonasEnvio&&(e.zonasEnvio.incluida?.includes(p.zona)||e.zonasEnvio.adicional?.includes(p.zona)))),"asc"===p.orden&&e.sort((e,t)=>e.precio.usd-t.precio.usd),"desc"===p.orden&&e.sort((e,t)=>t.precio.usd-e.precio.usd),g=e,m=u,y(),I(),a&&(a.textContent=0===g.length?"No se encontraron productos con esos filtros.":`Se encontraron ${g.length} productos.`)},I=()=>{c&&c.classList.toggle("hidden",m>=g.length)};c&&c.addEventListener("click",()=>{m+=u,y(),I()}),e&&(e.addEventListener("change",()=>{p.search=e.value.trim(),h(),E(),b()}),e.addEventListener("search",()=>{p.search=e.value.trim(),h(),E(),b()}),e.addEventListener("input",b)),[t,n,o].forEach(e=>{e&&e.addEventListener("change",()=>{p[e.id]=e.value,h(),E(),b()})}),i&&i.addEventListener("click",()=>{p.search=e.value.trim(),h(),E(),b()}),d&&d.addEventListener("click",()=>{p={search:"",categoria:"todas",zona:"todas",orden:"default"},e&&(e.value=""),t&&(t.value="todas"),n&&(n.value="todas"),o&&(o.value="default"),m=u,h(),E(),b()}),E(),b()}if(n&&"undefined"!=typeof PRODUCTS){let e=new URLSearchParams(location.search).get("id");if(!e){const t=location.pathname.match(/producto-(.+)\.html$/);t&&(e=t[1])}const t=document.querySelector(".producto-detalle"),n=document.querySelector(".no-product");if(!e)return t&&(t.style.display="none"),void(n&&(n.style.display="block"));if(e&&"undefined"!=typeof PRODUCTS){const o=PRODUCTS.find(t=>t.id===e);if(!o)return t&&(t.style.display="none"),void(n&&(n.style.display="block"));if(o){const e=document.getElementById("productImage"),n=document.getElementById("productName"),a=document.getElementById("productPrice"),s=document.getElementById("oldPrice"),r=document.getElementById("productDescription"),i=document.getElementById("productDetails"),d=document.getElementById("shippingInfo"),c=document.getElementById("whatsappBtn"),l=document.getElementById("callBtn"),u=document.getElementById("badgeOferta");if(e&&(e.src=o.imagen,e.alt=o.nombre),n&&(n.textContent=o.nombre),a&&(a.textContent=o.precio?.usd?`USD ${o.precio.usd}`:"Consultar"),r&&(r.textContent=o.descripcion||"Descripci√≥n no disponible"),u&&(u.style.display="none"),u&&(o.oferta&&o.precioAnterior?(u.textContent="OFERTA",u.style.display="inline-block"):o.nuevo?(u.textContent="NUEVO",u.style.display="inline-block"):o.disponible||(u.textContent="AGOTADO",u.style.display="inline-block")),s&&(o.oferta&&o.precioAnterior?(s.textContent=`USD ${o.precioAnterior}`,s.style.display="inline"):s.style.display="none"),i&&(i.innerHTML=(o.especificaciones||[]).map(e=>`<li>‚úî ${e}</li>`).join("")),d){let e="";o.zonasEnvio?.incluida?.length?e+=`<h4>Mensajer√≠a incluida</h4><ul class="zonas incluida">${o.zonasEnvio.incluida.map(e=>`<li>${e}</li>`).join("")}</ul>`:e+="<p><strong>Mensajer√≠a incluida:</strong> No disponible</p>",o.zonasEnvio?.adicional?.length&&(e+=`<h4>Mensajer√≠a adicional</h4><ul class="zonas adicional">${o.zonasEnvio.adicional.map(e=>`<li>${e}</li>`).join("")}</ul>`),o.monedas?.length&&(e+=`<p><strong>Monedas aceptadas:</strong> ${o.monedas.join(", ")}</p>`),o.garantia&&(e+=`<p><strong>Garant√≠a:</strong> ${o.garantia}</p>`),o.extras?.length&&(e+=`<p><strong>Extras:</strong> ${o.extras.join(", ")}</p>`),d.innerHTML=e}o.disponible?initContactButtons(c,l):(u&&(u.textContent="AGOTADO",u.style.display="inline-block"),c&&(c.removeAttribute("href"),c.classList.add("disabled"),c.textContent="Agotado",c.setAttribute("aria-disabled","true")),l&&(l.removeAttribute("href"),l.classList.add("disabled"),l.setAttribute("aria-disabled","true")),t&&t.classList.add("product-soldout"));const m=document.getElementById("seoTitle"),g=document.getElementById("seoDescription"),p=document.getElementById("ogTitle"),h=document.getElementById("ogDescription"),y=document.getElementById("ogImage"),f=document.getElementById("preloadOgImage"),v=document.getElementById("ogUrl"),b=o.precio?.usd?`USD ${o.precio.usd}`:"Consultar precio",E=`${o.nombre} en venta en Makro VC. ${o.descripcion||""} Precio: ${b}. Mensajer√≠a incluida en Cuba.`,I=document.getElementById("canonicalLink");m&&(m.textContent=`${o.nombre} | Makro VC`),g&&g.setAttribute("content",E),p&&(p.content=o.nombre+" | Makro VC"),h&&(h.content=o.descripcion||"Producto disponible en Makro VC"),y&&(y.content=o.imagen),f&&(f.href=o.imagen),v&&(v.content=`https://makrovc.net/producto-${o.id}.html`),I&&o?.id&&(I.href=`https://makrovc.net/producto-${o.id}.html`)}}}!function(){const e=document.querySelector(".testimonials-scroll");if(!e)return;if(window.innerWidth>768)return;let t=!1;e.addEventListener("touchstart",()=>{t=!0},{once:!0});const n=new IntersectionObserver(o=>{o.forEach(o=>{o.isIntersecting&&(n.disconnect(),setTimeout(()=>{t||e.scrollWidth<=e.clientWidth||e.scrollBy({left:80,behavior:"smooth"})},400))})},{threshold:.4});n.observe(e)}(),function(){const e=document.querySelectorAll(".testimonial.slide-right");if(!e.length)return;const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&e.target.classList.add("show")})},{threshold:.3});e.forEach(e=>t.observe(e))}()});